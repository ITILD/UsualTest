function e(){console.log("TMFunc1")}class i{constructor(e){this.viewers=new Map,Cesium.Ion.defaultAccessToken=e||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2MTRiM2IxYy1iZGZkLTRmOTktYWVhMi0xZTE2ZjU4NzliMDMiLCJpZCI6Mzc0NjAsImlhdCI6MTYwNTA3NzQ1MX0.GEvT_KwEV9MjAqyXHyS-ezcITyKc53X3MQDWBLPElI0"}static getInstance(){return this.Instance||(this.Instance=new i),this.Instance}addViewer(e){let i=new Cesium.Viewer(e,{animation:!0,baseLayerPicker:!0,fullscreenButton:!0,vrButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,timeline:!0,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1});return i.imageryLayers.removeAll(),this.viewers.set(e,i),i}}function t(e){if(e.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),e.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),haoutil.system.isPCBroswer()||(e.targetFrameRate=20,e.requestRenderMode=!0,e.scene.fog.enable=!1,e.scene.skyAtmosphere.show=!1,e.scene.fxaa=!1),window.navigator.userAgent.toLowerCase().indexOf("msie")>=0&&(e.targetFrameRate=20,e.requestRenderMode=!0),e.scene.logarithmicDepthBuffer=!1,e.scene.postProcessStages.fxaa.enabled=!1,console.log("--------","postProcessStages.fxaa.enabled = true"),e.scene.highDynamicRange=!1,Cesium.RequestScheduler.maximumRequests=100,Cesium.RequestScheduler.maximumRequestsPerServer=100,e.sceneModePicker&&(e.sceneModePicker.viewModel.duration=0),e.cesiumWidget._supportsImageRenderingPixelated){let i=window.devicePixelRatio;for(;i>=2;)i/=2;e.resolutionScale=i}}class s{constructor(){}static booleanClockwise(){}static booleanClockwiseWindow(){}static booleanClockwiseGloble(){}static getLerpByPoints(e,i){let t=e[0],s=e[1],o=[t],r=Math.ceil(i*Cesium.Cartesian3.distance(t,s,new Cesium.Cartesian3));for(let e=1;e<r;e++){let i=Cesium.Cartesian3.lerp(t,s,e/r,new Cesium.Cartesian3);o.push(i)}return o.push(s),o}static polygonDirectionSet(e,i){let t=e.length-1,s=e,o=Cesium.Cartesian3.subtract(s[t-1],s[t-2],new Cesium.Cartesian3),r=Cesium.Cartesian3.subtract(s[t],s[t-1],new Cesium.Cartesian3),l=Cesium.Cartesian3.cross(o,r,new Cesium.Cartesian3),n=Cesium.Cartesian3.angleBetween(l,s[t]),a=Cesium.Cartesian3.subtract(s[t],s[0],new Cesium.Cartesian3),h=Cesium.Cartesian3.cross(a,r,new Cesium.Cartesian3);return Cesium.Cartesian3.angleBetween(h,s[t]),n<1.57?(console.log("逆时针"),i=-1):(console.log("顺时针"),i=1),i}}class o{}class r{constructor(e){this.viewer=e,this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas)}stateStart(){this._clickPositionsArrays=[],this._clickPositions=[0],this.click_LEFT_CLICK_Time=new Date}drawListen(){this.stateStart(),this.handler.setInputAction((e=>{if(!e.endPosition)return;let i=this.viewer.scene.pickPosition(e.endPosition);i&&(this._clickPositions[this._clickPositions.length-1]=i),this.click_MOUSE_MOVE=this._clickPositions}),Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.setInputAction((e=>{let i=this.viewer.scene.pickPosition(e.position);i&&this.singleLeftClickBool()&&(this.click_LEFT_CLICK=this._clickPositions,this._clickPositions.push(i))}),Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.setInputAction((e=>{let i=e.position;this.viewer.scene.pickPosition(i)&&(this._clickPositions.pop(),this._clickPositionsArrays.push(this._clickPositions),this._clickPositionsStatic=this._clickPositions.slice(0),this.click_LEFT_DOUBLE_CLICK=this._clickPositions,this._clickPositions=[0])}),Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}set click_MOUSE_MOVE(e){this.test()}set click_LEFT_CLICK(e){this.test()}set click_LEFT_DOUBLE_CLICK(e){this.test()}removeAll(){this.handler=this.handler&&this.handler.destroy(),this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this._clickPositionsArrays=null,this._clickPositions=null}singleLeftClickBool(){let e=new Date,i=e-this.click_LEFT_CLICK_Time>300,t=this._clickPositions.length<2||Cesium.Cartesian3.distance(this._clickPositions[this._clickPositions.length-1],this._clickPositions[this._clickPositions.length-2])>.1;return this.click_LEFT_CLICK_Time=e,i||t}test(){console.log(this._clickPositions),console.log(this._clickPositionsArrays)}}class l{constructor(e,i){this.RCSMatrix="northEastDown"==i?Cesium.Transforms.northEastDownToFixedFrame(e):"northUpEast"==i?Cesium.Transforms.northUpEastToFixedFrame(e):"northWestUp"==i?Cesium.Transforms.northWestUpToFixedFrame(e):Cesium.Transforms.eastNorthUpToFixedFrame(e),this.RCSmatrixInverse=Cesium.Matrix4.inverseTransformation(this.RCSMatrix,new Cesium.Matrix4)}localToWorldCoordinates(e,i){return i||(i=new Cesium.Cartesian3),Cesium.Matrix4.multiplyByPoint(this.RCSMatrix,e,i),i}WorldCoordinatesTolocal(e,i){return i||(i=new Cesium.Cartesian3),Cesium.Matrix4.multiplyByPoint(this.RCSmatrixInverse,e,i),i}}class n{constructor(){}static setClippingPlanesSimple(e,i,t){for(let s=0;s<e.length;s++){let o=e[s],r=[];switch(o.constructor.name){case"Globe":for(let e=0;e<i.length;++e){let s=(e+1)%i.length,o=Cesium.Cartesian3.add(i[e],i[s],new Cesium.Cartesian3),l=Cesium.Cartesian3.subtract(i[e],i[s],new Cesium.Cartesian3);Cesium.Cartesian3.multiplyByScalar(l,t,l);let n=Cesium.Cartesian3.cross(l,o,new Cesium.Cartesian3),a=Cesium.Plane.fromPointNormal(i[e],n);r.push(Cesium.ClippingPlane.fromPlane(a))}break;case"Cesium3DTileset":let e=[],s=new l(o.boundingSphere.center);i.forEach((i=>{let t=s.WorldCoordinatesTolocal(i);e.push(t)}));for(let i=0;i<e.length;++i){let s=(i+1)%e.length,o=new Cesium.Cartesian3(0,0,10),l=Cesium.Cartesian3.subtract(e[i],e[s],new Cesium.Cartesian3);Cesium.Cartesian3.multiplyByScalar(l,t,l);let n=Cesium.Cartesian3.cross(l,o,new Cesium.Cartesian3),a=Cesium.Plane.fromPointNormal(e[i],n);r.push(Cesium.ClippingPlane.fromPlane(a))}}o.clippingPlanes=new Cesium.ClippingPlaneCollection({planes:r,edgeWidth:1,edgeColor:Cesium.Color.WHITE})}}static destroyAll(e){e.forEach((e=>{e.clippingPlanes=e.clippingPlanes&&e.clippingPlanes.destroy()}))}}class a{constructor(){}static simplePointByPrimitives(e,i,t,s,o){return e.add({show:!0,position:i,pixelSize:t,color:s||Cesium.Color.WHITE,outlineColor:Cesium.Color.WHITE,outlineWidth:o||1,id:void 0})}static simplePolygonByPrimitive(e,i,t,s,o){}static simplePolygonByPrimitiveInstance(e,i,t,s){let o;t&&(o={fabric:{type:"Color",uniforms:{color:t}}}),s&&(o={fabric:{type:"DiffuseMap",uniforms:{image:s,repeat:{x:1,y:1}}}});let r=new Cesium.GeometryInstance({geometry:new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(i),perPositionHeight:!0})});e.add(new Cesium.Primitive({geometryInstances:[r],appearance:new Cesium.MaterialAppearance({material:new Cesium.Material(o)})}))}static simpleVolumeBox(e,i,t,s,o){e.add({show:!0,position:Cesium.Cartesian3.ZERO,pixelSize:t,color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString(s).withAlpha(o)),outlineColor:Cesium.Color.TRANSPARENT,outlineWidth:0,id:void 0})}static simpleLineByPrimitive(e,i,t,s,o){let r=null!=o,l=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:Cesium.Cartesian3.fromDegreesArray(i),width:t,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString(s).withAlpha(o))}}),appearance:new Cesium.PolylineColorAppearance({translucent:r})});e.add(l)}static simpleLineHeightByPrimitive(e,i,t,s,o,r){let l=r||!1,n=new Cesium.Primitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.PolylineGeometry({positions:i||Cesium.Cartesian3.fromDegreesArrayHeights(t),width:s,vertexFormat:Cesium.PolylineColorAppearance.VERTEX_FORMAT}),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromCssColorString(o).withAlpha(r))}}),appearance:new Cesium.PolylineColorAppearance({translucent:l})});e.add(n)}}class h extends r{constructor(e,i){super(e),this.holeTerrainDrawBool=!1,this.hole3DtilesDrawBool=!1,this.pointDensity=1,this.holeBottomImgPath=i||"./work/img/excavate_bottom_min.jpg",this.holeBottomDepth=-50}stateStart(){super.stateStart(),this.PrimitiveAll=this.PrimitiveAll||this.viewer.scene.primitives.add(new Cesium.PrimitiveCollection),this.globe=this.viewer.scene.globe,this.polygonDirectionStart=null,this.polygonDirection=null,this._polygonPrimitives=this.PrimitiveAll.add(new Cesium.PrimitiveCollection),this._holeWallPositions=[],this._holeDownPositions=null,this.clippingPlanesModels=[]}holeTerrainDrawStart(){this.holeTerrainDrawBool=!0,this.clippingPlanesModels.push(this.globe)}hole3DtilesDrawStart(e){this.hole3DtilesDrawBool=!0,this.viewer.scene.primitives._primitives.forEach((e=>{"https://assets.cesium.com/354759/tileset.json?v=1"==e._url&&(this.tileset=e,this.localAndWorldTransform=new l(this.tileset.boundingSphere.center),this.clippingPlanesModels.push(this.tileset))}))}set click_MOUSE_MOVE(e){3==this._clickPositions.length&&(this.polygonDirection=s.polygonDirectionSet(this._clickPositions,this.polygonDirection),this.polygonDirectionStart=this.polygonDirection),this._clickPositions.length>3&&(this.polygonDirection=s.polygonDirectionSet(this._clickPositions,this.polygonDirection)),this.holeTerrainDrawBool,this.hole3DtilesDrawBool}set click_LEFT_CLICK(e){this.singleLeftClickBool()&&(this.holeTerrainDrawBool&&1==this._clickPositions.length&&this.viewer.scene.globe.clippingPlanes&&(this.viewer.scene.globe.clippingPlanes=null),this.hole3DtilesDrawBool&&1==this._clickPositions.length&&this.tileset&&this.tileset.clippingPlanes&&this.tileset.clippingPlanes.destroy())}set click_LEFT_DOUBLE_CLICK(e){if(this._clickPositions.length>2&&this._polygonPrimitives.removeAll(),this.holeTerrainDrawBool){let e=this._clickPositions.length,i=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this._clickPositionsStatic[0]).height+this.holeBottomDepth;if(e>2){this._holeDownPositions=[];for(let e=0;e<this._clickPositionsStatic.length;e++){let t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this._clickPositionsStatic[e]);t.height=i,this._holeDownPositions.push(Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height))}for(let i=0;i<this._clickPositionsStatic.length;i++){let t=(i+1)%e,o=[this._clickPositionsStatic[i],this._clickPositionsStatic[t]],r=s.getLerpByPoints(o,this.pointDensity);this.viewer.scene.clampToHeightMostDetailed(r).then((e=>{for(let i=0;i<e.length;i++){let t=e[i];(null==t||null==t)&&e.splice(i,1)}e.push(this._holeDownPositions[t],this._holeDownPositions[i]),a.simplePolygonByPrimitiveInstance(this._polygonPrimitives,e,Cesium.Color.fromBytes(161,169,173,255)),i==this._clickPositionsStatic.length-1&&n.setClippingPlanesSimple(this.clippingPlanesModels,this._clickPositionsStatic,this.polygonDirectionStart)}))}a.simplePolygonByPrimitiveInstance(this._polygonPrimitives,this._holeDownPositions,null,this.holeBottomImgPath)}}this.hole3DtilesDrawBool}removeAll(){super.removeAll(),this.PrimitiveAll.removeAll(),this._mouseMovePointPrimitives=null,this.viewer.scene.globe.clippingPlanes=null}}class c{constructor(e){this.viewer=e}PolylineVolumeGeometryInstance(e,i,t,s){let o=new Cesium.GeometryInstance({geometry:new Cesium.PolylineVolumeGeometry({vertexFormat:Cesium.MaterialAppearance.MaterialSupport.BASIC.vertexFormat,polylinePositions:i,shapePositions:s}),id:e});t.add(new Cesium.Primitive({geometryInstances:[o],appearance:new Cesium.MaterialAppearance({material:Cesium.Material.fromType("Color",{color:Cesium.Color.fromAlpha(Cesium.Color.fromCssColorString("#79D9FF"),.4)}),flat:!0})}))}}class m{constructor(e){this.viewer=e}renderSimpleGlb(e,i,t,s){t||(t=this.viewer.scene.primitives);let o=t.add(Cesium.Model.fromGltf({url:e,modelMatrix:i}));return!!s&&o.readyPromise.then((e=>{e.color=s.color,e.colorBlendMode=Cesium.ColorBlendMode.MIX,e.colorBlendAmount=s.colorBlendAmount,e.silhouetteColor=s.silhouetteColor,e.silhouetteSize=s.silhouetteSize,this.viewer.camera}))}static renderGlbPositionGraphic(e,i,t,s,o){let r=Cesium.Transforms.eastNorthUpToFixedFrame(t),l=Cesium.Model.fromGltf({url:i,modelMatrix:r,scale:o});return e.scene.primitives.add(l),l}}class d{}class u{constructor(e){this.viewer=e,this.camera=e.scene.camera}setParams(e,i,t,s,o){this.tilesCountAdd=i,this.tilesCount=2*this.tilesCountAdd+1,this.tilesSize=Math.pow(this.tilesCount,2),this.requestHeight=t,this.renderArrayHeight=s,e?this.levZ=e:o&&(this.levZ=Math.floor(Math.log(Math.PI/o)/Math.log(2))),this.dlat=Math.PI/Math.pow(2,this.levZ),this.dlon=2*this.dlat,this.row=0,this.col=0,this.tilesIdArraysOld=[],this.tilesMapWillAdd=new Map,this.tilesSetWillDelete=new Set,this.tilesMapRenderNow=new Map}startListener(e){this.cesiumParams={viewer:this.viewer,camera:this.camera,endRender:!1},this.featureFunction=e,e||(this.featureFunction=this.testCameraBox),this.batchRender(),this.removeChanged=this.camera.changed.addEventListener((()=>{this.batchRender()}))}endListener(){this.removeChanged(),this.destoryTiles()}destoryTiles(){this.tilesMapWillAdd.clear(),this.cesiumParams.endRender=!0,this.tilesIdArraysOld=[],this.tilesMapRenderNow.forEach(((e,i)=>{this.viewer.scene.primitives.remove(e),this.tilesMapRenderNow.delete(i)}))}calibration(){let e=this.camera.positionCartographic;e.height<this.requestHeight&&this.getTilesArrays(e.longitude,e.latitude)&&(this.tilesMapWillAdd.forEach(((e,i)=>{this.tilesMapWillAdd.delete(i),this.testCameraBox(e,i)})),this.tilesSetWillDelete.forEach((e=>{this.tilesSetWillDelete.delete(e),this.viewer.scene.primitives.remove(this.tilesMapRenderNow.get(e)),this.tilesMapRenderNow.delete(e)})))}testCameraBox(e,i,t,s,o){let r=e.viewer,l=null,n=new Cesium.GeometryInstance({geometry:Cesium.PolygonGeometry.fromPositions({extrudedHeight:10,positions:Cesium.Cartesian3.fromDegreesArray(t),vertexFormat:Cesium.PerInstanceColorAppearance.VERTEX_FORMAT}),attributes:{distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(o[0],o[1]),color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromRandom({alpha:.5}))}});l=new Cesium.Primitive({geometryInstances:[n],appearance:new Cesium.PerInstanceColorAppearance({closed:!0,translucent:!1})}),r.scene.primitives.add(l),i.set(s,l)}getTilesArrays(e,i){let t=Math.PI+e,s=Math.PI/2-i,o=t/this.dlon,r=s/this.dlat,l=Math.floor(r),n=Math.floor(o),a=l-this.row,h=n-this.col;if(0==a&&0==h)return!1;let c=[],m=[],d=Math.PI,u=180/d;for(let e=-this.tilesCountAdd;e<=this.tilesCountAdd;e++)for(let i=-this.tilesCountAdd;i<=this.tilesCountAdd;i++){let t={id:n+i+" "+(l+e)};t.positionArrays=[((n+i)*this.dlon-d)*u,(d/2-(l+e)*this.dlat)*u,((n+i+1)*this.dlon-d)*u,(d/2-(l+e)*this.dlat)*u,((n+i+1)*this.dlon-d)*u,(d/2-(l+e+1)*this.dlat)*u,((n+i)*this.dlon-d)*u,(d/2-(l+e+1)*this.dlat)*u],c.push(t),m.push(t.id)}let C=this.tilesIdArraysOld.filter((e=>!new Set(m).has(e))),p=c.filter((e=>!new Set(this.tilesIdArraysOld).has(e.id)));if(this.tilesIdArraysOld)for(let e=0;e<C.length;e++)this.tilesSetWillDelete.add(C[e]),this.tilesMapWillAdd.delete(C[e]);for(let e=0;e<p.length;e++)this.tilesMapWillAdd.set(p[e].id,p[e].positionArrays);return this.tilesIdArraysOld=m.slice(),this.row=Math.floor(r),this.col=Math.floor(o),!0}batchRender(){let e=this.camera.positionCartographic;e.height<this.requestHeight&&this.getTilesArrays(e.longitude,e.latitude)&&(this.tilesMapWillAdd.forEach(((e,i)=>{this.tilesMapWillAdd.delete(i),this.featureFunction(this.cesiumParams,this.tilesMapRenderNow,e,i,this.renderArrayHeight)})),this.tilesSetWillDelete.forEach((e=>{this.tilesMapRenderNow.get(e)&&(this.viewer.scene.primitives.remove(this.tilesMapRenderNow.get(e)),this.tilesSetWillDelete.delete(e),this.tilesMapRenderNow.delete(e))})))}}class C{constructor(e){this.viewer=e,this.camera=e.scene.camera}setParams(e,i,t,s,o){this.tilesCountAdd=i,this.tilesCount=2*this.tilesCountAdd+1,this.tilesSize=Math.pow(this.tilesCount,2),this.requestHeight=t,this.renderArrayHeight=s,e?this.levZ=e:o&&(this.levZ=Math.floor(Math.log(Math.PI/o)/Math.log(2))),this.dlat=Math.PI/Math.pow(2,this.levZ),this.dlon=2*this.dlat,this.row=0,this.col=0,this.tilesIdArraysOld=[],this.tilesMapWillAdd=new Map,this.tilesSetWillDelete=new Set,this.tilesMapRenderNow=new Map}startListener(e){this.cesiumParams={viewer:this.viewer,camera:this.camera,endRender:!1},this.featureFunction=e,e||(this.featureFunction=this.testCameraBox),this.batchRender(),this.removeChanged=this.camera.changed.addEventListener((()=>{this.batchRender()}))}endListener(){this.removeChanged(),this.destoryTiles()}destoryTiles(){this.tilesMapWillAdd.clear(),this.cesiumParams.endRender=!0,this.tilesIdArraysOld=[],this.tilesMapRenderNow.forEach(((e,i)=>{this.viewer.scene.primitives.remove(e),this.tilesMapRenderNow.delete(i)}))}calibration(){let e=this.camera.positionCartographic;e.height<this.requestHeight&&this.getTilesArrays(e.longitude,e.latitude)&&(this.tilesMapWillAdd.forEach(((e,i)=>{this.tilesMapWillAdd.delete(i),this.testCameraBox(e,i)})),this.tilesSetWillDelete.forEach((e=>{this.tilesSetWillDelete.delete(e),this.viewer.scene.primitives.remove(this.tilesMapRenderNow.get(e)),this.tilesMapRenderNow.delete(e)})))}testCameraBox(e,i,t,s,o){let r=e.viewer,l=null,n=new Cesium.GeometryInstance({geometry:Cesium.PolygonGeometry.fromPositions({extrudedHeight:10,positions:Cesium.Cartesian3.fromDegreesArray(t),vertexFormat:Cesium.PerInstanceColorAppearance.VERTEX_FORMAT}),attributes:{distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(o[0],o[1]),color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromRandom({alpha:.5}))}});l=new Cesium.Primitive({geometryInstances:[n],appearance:new Cesium.PerInstanceColorAppearance({closed:!0,translucent:!1})}),r.scene.primitives.add(l),i.set(s,l)}getTilesArrays(e,i){let t=Math.PI+e,s=Math.PI/2-i,o=t/this.dlon,r=s/this.dlat,l=Math.floor(r),n=Math.floor(o),a=l-this.row,h=n-this.col;if(0==a&&0==h)return!1;let c=[],m=[],d=Math.PI,u=180/d;for(let e=-this.tilesCountAdd;e<=this.tilesCountAdd;e++)for(let i=-this.tilesCountAdd;i<=this.tilesCountAdd;i++){let t={id:n+i+" "+(l+e)};t.positionArrays=[((n+i)*this.dlon-d)*u,(d/2-(l+e)*this.dlat)*u,((n+i+1)*this.dlon-d)*u,(d/2-(l+e)*this.dlat)*u,((n+i+1)*this.dlon-d)*u,(d/2-(l+e+1)*this.dlat)*u,((n+i)*this.dlon-d)*u,(d/2-(l+e+1)*this.dlat)*u],c.push(t),m.push(t.id)}let C=this.tilesIdArraysOld.filter((e=>!new Set(m).has(e))),p=c.filter((e=>!new Set(this.tilesIdArraysOld).has(e.id)));if(this.tilesIdArraysOld)for(let e=0;e<C.length;e++)this.tilesSetWillDelete.add(C[e]),this.tilesMapWillAdd.delete(C[e]);for(let e=0;e<p.length;e++)this.tilesMapWillAdd.set(p[e].id,p[e].positionArrays);return this.tilesIdArraysOld=m.slice(),this.row=Math.floor(r),this.col=Math.floor(o),!0}batchRender(){let e=this.camera.positionCartographic;e.height<this.requestHeight&&this.getTilesArrays(e.longitude,e.latitude)&&(this.tilesMapWillAdd.forEach(((e,i)=>{this.tilesMapWillAdd.delete(i),this.featureFunction(this.cesiumParams,this.tilesMapRenderNow,e,i,this.renderArrayHeight)})),this.tilesSetWillDelete.forEach((e=>{this.tilesMapRenderNow.get(e)&&(this.viewer.scene.primitives.remove(this.tilesMapRenderNow.get(e)),this.tilesSetWillDelete.delete(e),this.tilesMapRenderNow.delete(e))})))}}class p{}class g{constructor(){}}class P{}class y{constructor(){}static PositionByCartographicChange(e,i,t,s){let o;for(let r=0;r<e.length;r++){let l=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e[r]);i&&(l.height+=i),t&&(l.lon+=t),s&&(l.lat+=s),o[r]=Cesium.Cartesian3.fromRadians(l)}return o}static getPositionAndCartographic(e,i,t){let s,o,r;switch(i){case"position":s=e;break;case"cartographicDegrees":o=e,s=Cesium.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height);break;case"cartographicRadians":r=e,s=Cesium.Cartesian3.fromRadians(e.longitude,e.latitude,e.height)}t.position=s,t.cartographicRadians=o=o||Cesium.Ellipsoid.WGS84.cartesianToCartographic(s),t.cartographicDegrees=r||{longitude:Cesium.Math.toDegrees(o.longitude),latitude:Cesium.Math.toDegrees(o.latitude),height:o.height}}}class w extends r{constructor(e){super(e),this.pointDrawBool=!1,this.lineDrawBool=!1,this.polygonDrawBool=!1,this.lineGroundDrawBool=!1,this.polygonGroundDrawBool=!1,this.storeEntities=!1,this.linearr=[]}randomColor(){this.pointColor=Cesium.Color.fromRandom(),this.lineColor=Cesium.Color.fromAlpha(this.pointColor,.7),this.polygonColor=Cesium.Color.fromAlpha(this.pointColor,.3)}stateStart(){super.stateStart(),this.randomColor(),this.PrimitiveAll=this.PrimitiveAll||this.viewer.scene.primitives.add(new Cesium.PrimitiveCollection);let e=new Cesium.CustomDataSource("clickEntityCollection");this.viewer.dataSources.add(e),this.entities=e.entities,this._mouseMovePointPrimitives||(this._mouseMovePointPrimitivesCollection=this.viewer.scene.primitives.add(new Cesium.PointPrimitiveCollection),this._mouseMovePointPrimitives=a.simplePointByPrimitives(this._mouseMovePointPrimitivesCollection,Cesium.Cartesian3.ZERO,20,Cesium.Color.fromAlpha(Cesium.Color.RED,.5),3)),this._pointPrimitives=this.PrimitiveAll.add(new Cesium.PointPrimitiveCollection),this._polylinePrimitive=this.PrimitiveAll.add(new Cesium.PolylineCollection),this._polygonPrimitives=this.PrimitiveAll.add(new Cesium.PrimitiveCollection),this._polylineGroundPrimitive=this.PrimitiveAll.add(new Cesium.PrimitiveCollection),this._polygonGroundPrimitive=this.PrimitiveAll.add(new Cesium.PrimitiveCollection),this.mouseLinePrimitive=null,this.mousePolygonGroundEntity=null,this.mouseLineGroundEntity=null}drawPointStart(){this.pointDrawBool=!this.pointDrawBool}drawLineStart(){this.lineDrawBool=!this.lineDrawBool}drawPolygonStart(){this.polygonDrawBool=!this.polygonDrawBool}drawGroundLineStart(){this.lineGroundDrawBool=!this.lineGroundDrawBool}drawGroundPolygonStart(){this.polygonGroundDrawBool=!this.polygonGroundDrawBool}storeEntitiesStart(){this.storeEntities=!this.storeEntities}set click_MOUSE_MOVE(e){this._mouseMovePointPrimitives.position=this._clickPositions[this._clickPositions.length-1],this.pointDrawBool,this.lineDrawBool&&this.mouseLinePrimitive&&(this.mouseLinePrimitive.positions=this._clickPositions),this.polygonDrawBool,this.lineGroundDrawBool&&this.mouseLineGroundEntity,this.polygonGroundDrawBool}set click_LEFT_CLICK(e){let i=this._clickPositions[this._clickPositions.length-1];this.pointDrawBool&&a.simplePointByPrimitives(this._pointPrimitives,i,10,Cesium.Color.fromAlpha(this.pointColor,.5),3),this.lineDrawBool&&(this.mouseLinePrimitive=this.mouseLinePrimitive||a.simpleLineByPrimitive(this._polylinePrimitive,this._clickPositions,10,this.lineColor)),this.polygonDrawBool,this.lineGroundDrawBool&&(this.mouseLineGroundEntity||(this.mouseLineGroundEntity=this.entities.add({name:"line",polyline:{positions:new Cesium.CallbackProperty((()=>this._clickPositions),!1),width:3,material:Cesium.Color.fromAlpha(this.lineColor,.5),clampToGround:!0}}))),this.polygonGroundDrawBool&&(this.mousePolygonGroundEntity||(console.log("绘制"),console.log(this._clickPositions),this.mousePolygonGroundEntity=this.entities.add({polygon:{hierarchy:new Cesium.CallbackProperty((()=>new Cesium.PolygonHierarchy(this._clickPositions)),!1),material:Cesium.Color.fromAlpha(this.lineColor,.3)}})))}set click_LEFT_DOUBLE_CLICK(e){if(this._clickPositions[this._clickPositions.length-1],this.pointDrawBool,this.lineDrawBool&&(this.mouseLinePrimitive=null),this.lineGroundDrawBool&&(console.log(this.mouseLineGroundEntity.polyline),this.storeEntities&&(this.mouseLineGroundEntity.polyline.positions=this._clickPositions),this.mouseLineGroundEntity=null),this.polygonDrawBool){console.log("绘制真实面",this._clickPositions);let e=Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromAlpha(this.pointColor,.5)),i=new Cesium.GeometryInstance({geometry:new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(this._clickPositions),perPositionHeight:!0}),attributes:{color:e}});this._polygonPrimitives.add(new Cesium.Primitive({geometryInstances:[i],appearance:new Cesium.PerInstanceColorAppearance}))}this.polygonGroundDrawBool&&(this.storeEntities&&(console.log(this.mouseLineGroundEntity),this.mousePolygonGroundEntity.polygon.hierarchy=new Cesium.PolygonHierarchy(this._clickPositions)),this.mousePolygonGroundEntity=null),this.randomColor()}removeAll(){super.removeAll(),this._mouseMovePointPrimitivesCollection.remove(this._mouseMovePointPrimitives),this._mouseMovePointPrimitives=null,this.PrimitiveAll.removeAll(),this.entities.removeAll()}}class v{constructor(e){this.camera=e}static cameraFlyTo(e,i){i.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z),orientation:{heading:Cesium.Math.toRadians(e.heading),pitch:Cesium.Math.toRadians(e.pitch),roll:Cesium.Math.toRadians(e.roll)}})}static cameraSetView(e,i){i.camera.setView({destination:Cesium.Cartesian3.fromDegrees(e.x,e.y,e.z),orientation:{heading:Cesium.Math.toRadians(e.heading),pitch:Cesium.Math.toRadians(e.pitch),roll:Cesium.Math.toRadians(e.roll)}})}static cameraSetViewGraphic(e,i){i.camera.setView({destination:Cesium.Cartesian3.fromDegrees(e.lon,e.lat,e.h),orientation:{heading:Cesium.Math.toRadians(e.heading),pitch:Cesium.Math.toRadians(e.pitch),roll:Cesium.Math.toRadians(e.roll)}})}static cameraSetViewCartesian3(e,i){i.camera.setView({destination:{x:e.x,y:e.y,z:e.z},orientation:{heading:Cesium.Math.toRadians(e.heading),pitch:Cesium.Math.toRadians(e.pitch),roll:Cesium.Math.toRadians(e.roll)}})}}class M{constructor(){this.handlers=new Map}static getInstance(){return this.Instance||(this.Instance=new M),this.Instance}addHandler(e,i){let t=new Cesium.ScreenSpaceEventHandler(i.scene.canvas);this.handlers.set(e,t)}}class S{constructor(e){this.viewer=e,this.layersIdConfig=new Map}addLayer(e){let i,t;switch(Cesium.RequestScheduler.maximumRequests=500,Cesium.RequestScheduler.maximumRequestsPerServer=500,e.type){case"tms":t=new Cesium.TileMapServiceImageryProvider({url:e.url});break;case"geoserver_WMTS":let s=["EPSG:4326:0","EPSG:4326:1","EPSG:4326:2","EPSG:4326:3","EPSG:4326:4","EPSG:4326:5","EPSG:4326:6","EPSG:4326:7","EPSG:4326:8","EPSG:4326:9","EPSG:4326:10","EPSG:4326:11","EPSG:4326:12","EPSG:4326:13","EPSG:4326:14","EPSG:4326:15","EPSG:4326:16","EPSG:4326:17","EPSG:4326:18","EPSG:4326:19","EPSG:4326:20","EPSG:4326:21"];t=new Cesium.WebMapTileServiceImageryProvider({url:e.url,layer:e.typename,style:"",format:"image/png",tileMatrixSetID:"EPSG:4326",tileMatrixLabels:s,tilingScheme:new Cesium.GeographicTilingScheme({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1})});break;case"osm_vt":t=new Cesium.OpenStreetMapImageryProvider({url:"https://a.tile.openstreetmap.org/"});break;case"tdt_img":i=e.key||"8a7a551905711535885142a660a10111",t=new Cesium.WebMapTileServiceImageryProvider({url:"http://{s}.tianditu.gov.cn/img_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=img&tileMatrixSet=c&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk="+i,layer:"tdtCva",style:"default",format:"tiles",tileMatrixSetID:"c",subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],tilingScheme:new Cesium.GeographicTilingScheme,tileMatrixLabels:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],maximumLevel:18,show:!1});break;case"tdt_lb":i=e.key||"8a7a551905711535885142a660a10111",t=new Cesium.WebMapTileServiceImageryProvider({url:"http://{s}.tianditu.gov.cn/cia_c/wmts?service=wmts&request=GetTile&version=1.0.0&LAYER=cia&tileMatrixSet=c&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}&style=default&format=tiles&tk="+i,layer:"tdtCva",style:"default",format:"tiles",tileMatrixSetID:"c",subdomains:["t0","t1","t2","t3","t4","t5","t6","t7"],tilingScheme:new Cesium.GeographicTilingScheme,tileMatrixLabels:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],maximumLevel:18,show:!1});break;case"bing_img":t=Cesium.createWorldImagery({style:Cesium.IonWorldImageryStyle.AERIAL});break;case"bing_lb":t=Cesium.createWorldImagery({style:Cesium.IonWorldImageryStyle.AERIAL_WITH_LABELS});break;case"3dtiles":e.layer=this.viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:e.url,maximumScreenSpaceError:2,maximumNumberOfLoadedTiles:1e4,show:!0})),this.layersIdConfig.set(e.id,e);break;case"test3Dtiles":Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2MTRiM2IxYy1iZGZkLTRmOTktYWVhMi0xZTE2ZjU4NzliMDMiLCJpZCI6Mzc0NjAsImlhdCI6MTYwNTA3NzQ1MX0.GEvT_KwEV9MjAqyXHyS-ezcITyKc53X3MQDWBLPElI0",e.layer=this.viewer.scene.primitives.add(new Cesium.Cesium3DTileset({url:Cesium.IonResource.fromAssetId(354759),maximumScreenSpaceError:2,maximumNumberOfLoadedTiles:1e4,show:!0})),this.layersIdConfig.set(e.id,e);break;case"terrain":this.viewer.terrainProvider=new Cesium.CesiumTerrainProvider({url:e.url}),this.layersIdConfig.set(e.id,e);break;case"WorldTerrain":this.viewer.terrainProvider=Cesium.createWorldTerrain({requestWaterMask:!0}),this.layersIdConfig.set(e.id,e)}t&&(e.layer=this.viewer.imageryLayers.addImageryProvider(t,e.order),this.layersIdConfig.set(e.id,e))}remove(e){let i=this.layersIdConfig.get(e.id).layer;switch(e.type){case"3dtiles":case"test3Dtiles":this.viewer.scene.primitives.remove(i);break;case"terrain":case"WorldTerrain":this.viewer.terrainProvider._ready&&(this.viewer.terrainProvider=new Cesium.EllipsoidTerrainProvider({}));break;default:this.viewer.imageryLayers.remove(i)}this.layersIdConfig.delete(e.id)}removeAll(){this.layersIdConfig.forEach((e=>{this.remove(e)}))}}class f{constructor(){}}class A{}class I{constructor(e){this.viewer=e,this.primitiveModelCollection=new Cesium.PrimitiveCollection,this.viewer.scene.primitives.add(this.primitiveModelCollection,"100"),this.tree=new Map}addNode(){}getNode(){}removeNode(){}updateNode(){}}let _="1.0";export{w as BaseDraw,S as BaseLayers,v as CameraPro,u as CesiumPrimitivesProvider,n as ClippingPlanesByGeom,s as ComputationalGeom,M as HandlerManager,h as HoleDraw,i as InitViewer,l as LocalAndWorldTransform,p as M4Translate,g as MouseClickTrans,r as MouseListen,I as PrimitivesTree,m as RenderGlb,c as RenderInstance,f as RenderPlanes,a as RenderSimple,e as TMFunc1,A as TerrainProvider,P as TranslateSevenParams,C as Universal3DSceneInterface,o as UsualGeom,_ as VERSION,t as ViwerSet,y as WorldPositionTransform,d as renderModelByprimitive};
//# sourceMappingURL=cesiumplugin.mjs.map
